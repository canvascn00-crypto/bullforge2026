<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bullforge | The Future isn't Just Bullish. It's Bullforge.</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --gold-primary:#FFD700; --gold-secondary:#FFA500;
      --dark-bg:#050505; --dark-card:#0F0F0F; --dark-border:#1A1A1A;
      --text-white:#fff; --text-gray:#A0A0A0; --text-muted:#666;
      --danger:#FF4444; --success:#00C853;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}
    html{scroll-behavior:smooth}
    body{background:var(--dark-bg);color:var(--text-white);line-height:1.6;overflow-x:hidden}
    .container{max-width:1320px;margin:0 auto;padding:0 20px}
    .page{display:none}.page.is-active{display:block}

    .navbar{position:fixed;top:0;left:0;width:100%;z-index:999;padding:14px 0;background:rgba(5,5,5,.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--dark-border)}
    .navbar-content{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .navbar-logo{font-size:26px;font-weight:900;color:var(--gold-primary);text-decoration:none;white-space:nowrap}
    .navbar-links{display:flex;gap:18px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .navbar-links a{color:var(--text-gray);text-decoration:none;font-weight:700}
    .navbar-links a:hover{color:var(--gold-primary)}
    .wallet-container{display:flex;gap:8px;align-items:center}
    #walletConnectBtn,#disconnectBtn,#networkBadge{border-radius:999px}
    #walletConnectBtn{padding:10px 18px;border:none;font-weight:900;background:var(--gold-primary);color:#111;cursor:pointer}
    #walletConnectBtn:disabled{opacity:.65;cursor:not-allowed}
    #disconnectBtn{display:none;padding:8px 14px;border:1px solid var(--gold-primary);background:transparent;color:var(--gold-primary);font-weight:800;cursor:pointer}
    #networkBadge{display:none;padding:5px 10px;border:1px solid var(--dark-border);color:var(--gold-primary);font-size:12px;font-weight:800}
    #networkBadge.bad{border-color:var(--danger);color:var(--danger)}

    .section{padding:110px 0;position:relative}
    .section-header{text-align:center;margin-bottom:56px}
    .section-subtitle{font-size:13px;text-transform:uppercase;letter-spacing:2px;color:var(--gold-primary);font-weight:800;margin-bottom:8px}
    .section-title{font-size:48px;font-weight:900;line-height:1.1;margin-bottom:10px}
    .section-desc{font-size:16px;color:var(--text-gray);max-width:820px;margin:0 auto}

    .hero{min-height:100vh;padding-top:120px;display:flex;align-items:center;text-align:center;background:linear-gradient(180deg,#0A0500 0%,#050505 100%)}
    .hero-bg-glow{position:absolute;top:-45%;left:50%;transform:translateX(-50%);width:1000px;height:1000px;background:radial-gradient(circle,rgba(255,215,0,.14),transparent 70%);pointer-events:none}
    .hero-content{position:relative;z-index:1;width:100%}
    .hero-title{font-size:68px;font-weight:900;line-height:1.06;background:linear-gradient(180deg,var(--gold-primary),var(--gold-secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .hero-slogan{font-size:22px;color:var(--text-gray);margin:12px 0 26px}
    .hero-cta-row{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-bottom:28px}
    .hero-cta-primary,.hero-cta-secondary{cursor:pointer;font-weight:900;border-radius:999px}
    .hero-cta-primary{padding:12px 20px;border:none;background:linear-gradient(90deg,var(--gold-secondary),var(--gold-primary));color:#111}
    .hero-cta-secondary{padding:10px 18px;border:2px solid var(--gold-primary);background:transparent;color:var(--gold-primary)}

    .presale-stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
    .stat-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:12px;padding:16px;text-align:left}
    .stat-label{font-size:12px;color:var(--text-muted);text-transform:uppercase;margin-bottom:6px}
    .stat-value{font-size:22px;font-weight:800;color:var(--gold-primary)}

    .countdown-wrapper{margin:20px 0}
    .countdown-title{font-size:13px;color:var(--text-gray);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px}
    .countdown-grid{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
    .countdown-box{min-width:90px;background:var(--dark-card);border:1px solid var(--gold-primary);border-radius:10px;padding:12px 8px}
    .countdown-number{font-size:34px;font-weight:900;color:var(--gold-primary);line-height:1}
    .countdown-text{font-size:11px;color:var(--text-gray);margin-top:6px;text-transform:uppercase}

    .progress-wrapper{width:100%;margin:20px 0}
    .progress-header{display:flex;justify-content:space-between;margin-bottom:8px}
    .progress-header span{font-size:13px;color:var(--text-gray)}
    .progress-bar-container{height:10px;background:var(--dark-card);border:1px solid var(--dark-border);border-radius:999px;overflow:hidden}
    .progress-bar-fill{height:100%;width:0;background:linear-gradient(90deg,var(--gold-secondary),var(--gold-primary));transition:width .45s ease}

    .buy-form-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:14px;padding:24px;max-width:680px;margin:0 auto}
    .form-input-group{margin-bottom:12px}
    .form-label{display:flex;justify-content:space-between;color:var(--text-gray);font-size:13px;margin-bottom:6px;gap:10px;flex-wrap:wrap}
    .form-input{width:100%;padding:14px;background:#070707;border:1px solid var(--dark-border);border-radius:10px;color:#fff;font-size:16px;font-weight:600}
    .form-input:focus{outline:none;border-color:var(--gold-primary)}
    .token-estimate{font-size:13px;color:var(--text-gray);margin:8px 0 14px}
    .buy-button{width:100%;padding:15px;border:none;border-radius:10px;background:linear-gradient(90deg,var(--gold-secondary),var(--gold-primary));color:#111;font-size:16px;font-weight:900;cursor:pointer}
    .buy-button:disabled{opacity:.55;cursor:not-allowed}
    .btn-secondary{width:100%;padding:12px;border:2px solid var(--gold-primary);background:transparent;color:var(--gold-primary);border-radius:10px;font-weight:800;margin-top:10px;cursor:pointer}
    .btn-small{width:auto;padding:9px 14px;font-size:13px;margin:4px}

    .feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
    .feature-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:14px;padding:26px}
    .feature-title{font-size:24px;font-weight:800;color:var(--gold-primary);margin-bottom:8px}
    .feature-desc{color:var(--text-gray)}
    .feature-icon{font-size:38px;margin-bottom:12px}

    .split-section{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:center}
    .split-media{border-radius:16px;border:1px solid var(--dark-border);min-height:300px;background:radial-gradient(circle at 30% 20%, rgba(255,215,0,.16), rgba(0,0,0,.2) 62%),linear-gradient(180deg, rgba(255,165,0,.12), rgba(0,0,0,.06));overflow:hidden}
    .split-copy{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:16px;padding:24px}
    .split-kicker{color:var(--gold-primary);font-size:12px;text-transform:uppercase;letter-spacing:1.5px;font-weight:900;margin-bottom:8px}
    .split-title{font-size:30px;font-weight:900;line-height:1.2;margin-bottom:10px}
    .split-text{color:var(--text-gray)}

    /* Ë∑ØÁ∫øÂõæ‚ÄúÊóÅËæπÂõæÁâá‚ÄùÂÜÖÁΩÆÂÆπÂô® */
    .roadmap-visual{
      border:1px solid var(--dark-border);
      border-radius:16px;
      padding:14px;
      background:linear-gradient(180deg,#111,#090909);
    }
    .roadmap-visual svg{width:100%;height:auto;display:block}

    .roadmap-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
    .roadmap-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:14px;padding:22px}
    .roadmap-phase{font-size:12px;color:var(--gold-primary);font-weight:800;text-transform:uppercase;margin-bottom:6px}
    .roadmap-title{font-size:22px;font-weight:800;margin-bottom:10px}
    .roadmap-list{list-style:none}
    .roadmap-list li{padding:6px 0 6px 20px;color:var(--text-gray);position:relative}
    .roadmap-list li:before{content:"‚ú¶";position:absolute;left:0;color:var(--gold-primary)}

    .faq-item{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:12px;margin-bottom:10px;overflow:hidden}
    .faq-question{padding:18px;font-size:17px;font-weight:800;display:flex;justify-content:space-between;cursor:pointer}
    .faq-answer{display:none;padding:0 18px 18px;color:var(--text-gray)}

    .notification{position:fixed;top:90px;right:16px;max-width:360px;background:var(--dark-card);border:1px solid var(--gold-primary);padding:14px 16px;border-radius:10px;z-index:9999;transform:translateX(120%);transition:transform .25s}
    .notification.show{transform:translateX(0)}
    .notification-title{font-weight:900;margin-bottom:4px}
    .notification-desc{font-size:13px;color:var(--text-gray)}

    .loading-spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--text-muted);border-top-color:var(--gold-primary);border-radius:50%;animation:spin .9s linear infinite;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media(max-width:980px){.split-section{grid-template-columns:1fr}.presale-stats-grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:768px){
      .navbar-links a{display:none}
      .hero-title{font-size:42px}
      .hero-slogan{font-size:17px}
      .section-title{font-size:34px}
      .countdown-box{min-width:72px}.countdown-number{font-size:26px}
      .notification{left:12px;right:12px;max-width:none}
    }
  </style>
</head>
<body>
  <div id="notification" class="notification">
    <div id="notificationTitle" class="notification-title"></div>
    <div id="notificationDesc" class="notification-desc"></div>
  </div>

  <nav class="navbar">
    <div class="container navbar-content">
      <a class="navbar-logo" href="#home" data-nav="home">üêÇ BULLFORGE</a>
      <div class="navbar-links">
        <a href="#home" data-nav="home">Buy Now</a>
        <a href="#howtobuy" data-nav="howtobuy">How to Buy</a>
        <a href="#whitepaper" data-nav="whitepaper">Whitepaper</a>
        <a href="#staking" data-nav="staking">Staking</a>
        <a href="#referral" data-nav="referral">Referral</a>
        <a href="#blog" data-nav="blog">Blog</a>
        <div class="wallet-container">
          <span id="networkBadge">BNB</span>
          <button id="walletConnectBtn">Connect Wallet</button>
          <button id="disconnectBtn">Disconnect</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- HOME -->
  <section class="hero page" data-page="home">
    <div class="hero-bg-glow"></div>
    <div class="container hero-content">
      <h1 class="hero-title">Bullforge</h1>
      <p class="hero-slogan">The Future isn't Just Bullish. It's Bullforge.</p>

      <div class="hero-cta-row">
        <button class="hero-cta-primary" id="jumpToBuyBtn">Á´ãÂç≥Ë¥≠‰π∞</button>
        <button class="hero-cta-secondary" id="jumpToWhitepaperBtn">Whitepaper</button>
      </div>

      <div class="presale-stats-grid">
        <div class="stat-card"><div class="stat-label">Current Price</div><div id="currentPrice" class="stat-value"><span class="loading-spinner"></span></div></div>
        <div class="stat-card"><div class="stat-label">Total Raised</div><div id="totalRaised" class="stat-value"><span class="loading-spinner"></span></div></div>
        <div class="stat-card"><div class="stat-label">Current Stage</div><div id="currentStage" class="stat-value"><span class="loading-spinner"></span></div></div>
        <div class="stat-card"><div class="stat-label">1 BNB =</div><div id="tokenRate" class="stat-value"><span class="loading-spinner"></span></div></div>
      </div>

      <div class="countdown-wrapper">
        <div class="countdown-title">PRESALE ENDS IN</div>
        <div class="countdown-grid">
          <div class="countdown-box"><div id="countdownDays" class="countdown-number">--</div><div class="countdown-text">Days</div></div>
          <div class="countdown-box"><div id="countdownHours" class="countdown-number">--</div><div class="countdown-text">Hours</div></div>
          <div class="countdown-box"><div id="countdownMinutes" class="countdown-number">--</div><div class="countdown-text">Minutes</div></div>
          <div class="countdown-box"><div id="countdownSeconds" class="countdown-number">--</div><div class="countdown-text">Seconds</div></div>
        </div>
      </div>

      <div class="progress-wrapper">
        <div class="progress-header"><span>Presale Progress</span><span id="progressPercent">0%</span></div>
        <div class="progress-bar-container"><div id="progressBarFill" class="progress-bar-fill"></div></div>
      </div>

      <!-- Ë¥≠‰π∞Ê†èÂè™Âú® home -->
      <div class="buy-form-card" id="buyFormAnchor">
        <div class="form-input-group">
          <div class="form-label"><span>Amount (BNB)</span><span>Balance: <span id="walletBalance">0.00</span> BNB</span></div>
          <input id="bnbAmount" class="form-input" type="number" step="0.01" min="0" placeholder="0.0" />
        </div>
        <div class="form-input-group">
          <div class="form-label"><span>Slippage Tolerance (%)</span></div>
          <input id="slippage" class="form-input" type="number" step="0.1" min="0.1" value="1.0" />
        </div>
        <div class="form-input-group">
          <div class="form-label"><span>Referrer Address (Optional)</span></div>
          <input id="referrerAddress" class="form-input" type="text" placeholder="0x..." />
        </div>
        <div id="tokenEstimate" class="token-estimate">Enter BNB amount to see estimated $BULL tokens</div>
        <button id="buyButton" class="buy-button" disabled>Connect Wallet To Buy</button>
        <button id="claimButton" class="btn-secondary" style="display:none;">Claim Your $BULL Tokens</button>
      </div>
    </div>
  </section>

  <section class="section page" data-page="home">
    <div class="container">
      <div class="section-header">
        <div class="section-subtitle">About Bullforge</div>
        <h2 class="section-title">Forged in Chaos. Built for Momentum.</h2>
        <p class="section-desc">Bullforge is a meme-driven myth with real mechanics.</p>
      </div>
      <div class="feature-grid">
        <div class="feature-card"><div class="feature-icon">‚è±Ô∏è</div><div class="feature-title">Progressive Price Engine</div><div class="feature-desc">Price advances stage by stage.</div></div>
        <div class="feature-card"><div class="feature-icon">üî•</div><div class="feature-title">Milestone Burns</div><div class="feature-desc">Supply reduces at key milestones.</div></div>
        <div class="feature-card"><div class="feature-icon">üíé</div><div class="feature-title">Holder-First Rewards</div><div class="feature-desc">Staking + referral for believers.</div></div>
      </div>
    </div>
  </section>

  <!-- Ë∑ØÁ∫øÂõæ + ÊóÅËæπÂõæÁâáÔºàÂ∑≤ÁîüÊàêÔºâ -->
  <section class="section page" data-page="home">
    <div class="container">
      <div class="section-header">
        <div class="section-subtitle">Roadmap</div>
        <h2 class="section-title">The Bullforge Launch Sequence</h2>
      </div>

      <div class="split-section" style="margin-bottom:20px;">
        <div class="roadmap-visual" aria-label="Roadmap visual">
          <!-- ÂÜÖÁΩÆSVGÔºåÁ®≥ÂÆö‰∏ç‰æùËµñÂ§ñÈìæ -->
          <svg viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg" role="img">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0%" stop-color="#FFA500"/>
                <stop offset="100%" stop-color="#FFD700"/>
              </linearGradient>
            </defs>
            <rect width="1200" height="700" fill="#0b0b0b"/>
            <circle cx="970" cy="120" r="180" fill="url(#g1)" opacity=".08"/>
            <path d="M120 560 C300 420, 460 620, 650 470 C820 340, 940 430, 1090 300" stroke="url(#g1)" stroke-width="10" fill="none"/>
            <g fill="#FFD700">
              <circle cx="180" cy="540" r="12"/><circle cx="430" cy="550" r="12"/><circle cx="700" cy="470" r="12"/><circle cx="950" cy="410" r="12"/>
            </g>
            <g fill="#fff" font-size="26" font-weight="800" font-family="Inter, sans-serif">
              <text x="130" y="505">Phase I</text>
              <text x="380" y="515">Phase II</text>
              <text x="650" y="435">Phase III</text>
              <text x="900" y="375">Phase IV</text>
            </g>
            <text x="70" y="90" fill="#FFD700" font-size="44" font-weight="900" font-family="Inter, sans-serif">BULLFORGE ROADMAP</text>
          </svg>
        </div>

        <div class="split-copy">
          <div class="split-kicker">Visual</div>
          <div class="split-title">Roadmap Momentum Curve</div>
          <p class="split-text">ËøôÂº†ÂõæÂ∑≤Áõ¥Êé•ÂÜÖÁΩÆÂà∞È°µÈù¢ÈáåÔºå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂõæÁâáËµÑÊ∫êÔºåÈÉ®ÁΩ≤ÊúÄÁ®≥ÂÆö„ÄÇ</p>
        </div>
      </div>

      <div class="roadmap-grid">
        <div class="roadmap-card"><div class="roadmap-phase">Phase I</div><div class="roadmap-title">The Spark</div><ul class="roadmap-list"><li>Brand reveal</li><li>Contract testing</li></ul></div>
        <div class="roadmap-card"><div class="roadmap-phase">Phase II</div><div class="roadmap-title">Presale Forge</div><ul class="roadmap-list"><li>Presale live</li><li>Milestone burns</li></ul></div>
        <div class="roadmap-card"><div class="roadmap-phase">Phase III</div><div class="roadmap-title">HODL Forge</div><ul class="roadmap-list"><li>Staking launch</li><li>Vesting logic</li></ul></div>
        <div class="roadmap-card"><div class="roadmap-phase">Phase IV</div><div class="roadmap-title">The Roar</div><ul class="roadmap-list"><li>Liquidity</li><li>Listings</li></ul></div>
      </div>
    </div>
  </section>

  <section class="section page" id="howtobuy" data-page="howtobuy"><div class="container"><div class="section-header"><div class="section-subtitle">How to Buy</div><h2 class="section-title">Buy $BULL in Minutes</h2></div></div></section>
  <section class="section page" id="whitepaper" data-page="whitepaper"><div class="container"><div class="section-header"><div class="section-subtitle">Whitepaper</div><h2 class="section-title">Bullforge Whitepaper</h2></div></div></section>
  <section class="section page" id="staking" data-page="staking"><div class="container"><div class="section-header"><div class="section-subtitle">Staking</div><h2 class="section-title">HODL Forge</h2></div></div></section>
  <section class="section page" id="referral" data-page="referral">
    <div class="container">
      <div class="section-header"><div class="section-subtitle">Referral</div><h2 class="section-title">Forge-To-Earn</h2></div>
      <div class="buy-form-card" style="max-width:900px;">
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <input id="referralLink2" class="form-input" readonly value="Connect wallet to generate..." style="flex:1;min-width:230px;">
          <button id="copyReferralBtn2" class="btn-secondary btn-small">Copy Link</button>
        </div>
      </div>
    </div>
  </section>
  <section class="section page" id="blog" data-page="blog"><div class="container"><div class="section-header"><div class="section-subtitle">Blog</div><h2 class="section-title">Blog</h2></div></div></section>
  <section class="section page" id="blogpost" data-page="blogpost"><div class="container"><div class="section-header"><h2 class="section-title">Post</h2></div></div></section>

  <script type="module">
    import { ethers } from 'https://esm.sh/ethers@5.7.2';
    import { Web3Modal } from 'https://esm.sh/@web3modal/html@2.7.1';
    import { EthereumClient, w3mConnectors, w3mProvider } from 'https://esm.sh/@web3modal/ethereum@2.7.1';
    import { configureChains, createClient } from 'https://esm.sh/wagmi@1.4.13';
    import { bsc } from 'https://esm.sh/wagmi/chains';

    // ====== ÈÖçÁΩÆ ======
    const CONFIG = {
      CONTRACT_ADDRESS: "0x16D6c1a692AaC51a3821bA2903115d4600649F07",
      WALLETCONNECT_PROJECT_ID: "fe819ed06d9e5489f764fc7b1dae1c4e",
      BSC_RPC: "https://bsc-dataseed.binance.org/",
      CHAIN_ID: 56
    };

    const ABI = [
      "function totalRaised() view returns (uint256)",
      "function currentStage() view returns (uint256)",
      "function stageEndTime() view returns (uint256)",
      "function getCurrentPrice() view returns (uint256)",
      "function getRate() view returns (uint256)",
      "function hardCap() view returns (uint256)",
      "function totalSupply() view returns (uint256)",
      "function buyTokens(address _referrer, uint256 _minTokensOut) payable",
      "function claimTokens()"
    ];

    // ====== DOM ======
    const $ = (id)=>document.getElementById(id);
    const notif=$('notification'), notifTitle=$('notificationTitle'), notifDesc=$('notificationDesc');
    const connectBtn=$('walletConnectBtn'), disconnectBtn=$('disconnectBtn'), networkBadge=$('networkBadge');
    const currentPriceSpan=$('currentPrice'), totalRaisedSpan=$('totalRaised'), currentStageSpan=$('currentStage'), tokenRateSpan=$('tokenRate');
    const progressPercent=$('progressPercent'), progressBarFill=$('progressBarFill');
    const daysSpan=$('countdownDays'), hoursSpan=$('countdownHours'), minutesSpan=$('countdownMinutes'), secondsSpan=$('countdownSeconds');
    const bnbAmountInput=$('bnbAmount'), slippageInput=$('slippage'), referrerInput=$('referrerAddress');
    const tokenEstimate=$('tokenEstimate'), walletBalanceSpan=$('walletBalance');
    const buyButton=$('buyButton'), claimButton=$('claimButton');
    const referralLink2=$('referralLink2'), copyBtn2=$('copyReferralBtn2');
    const jumpToBuyBtn=$('jumpToBuyBtn'), jumpToWhitepaperBtn=$('jumpToWhitepaperBtn');

    // ====== Áä∂ÊÄÅ ======
    let provider=null, signer=null, contract=null, userAddress=null;
    let readProvider = new ethers.providers.JsonRpcProvider(CONFIG.BSC_RPC);
    let currentRate=0, totalRaisedBNB=0, hardcapBNB=2000, stageEndTimestamp=0;
    let countdownTimer=null;

    function showNotification(title, desc, error=false){
      notifTitle.textContent=title; notifDesc.textContent=desc;
      notif.style.borderColor = error ? 'var(--danger)' : 'var(--gold-primary)';
      notif.classList.add('show'); setTimeout(()=>notif.classList.remove('show'), 3800);
    }

    function setActivePage(page){
      document.querySelectorAll('.page').forEach(p=>p.classList.toggle('is-active', p.dataset.page===page));
    }
    function routeFromHash(){
      const raw=(location.hash||'#home').replace('#','');
      if(!raw) return {page:'home'};
      if(raw.startsWith('blog/')) return {page:'blogpost',slug:raw.slice(5)};
      return {page:raw};
    }

    function setNetworkBadge(chainId){
      networkBadge.style.display='inline-block';
      if(chainId===CONFIG.CHAIN_ID){networkBadge.textContent='BNB (56)';networkBadge.classList.remove('bad');}
      else {networkBadge.textContent='Wrong Net';networkBadge.classList.add('bad');}
    }

    function estimateTokens(){
      const v=parseFloat(bnbAmountInput.value);
      if(!v || v<=0 || !currentRate){tokenEstimate.textContent='Enter BNB amount to see estimated $BULL tokens';return;}
      tokenEstimate.textContent=`You will receive approx. ${(v*currentRate).toFixed(2)} $BULL`;
    }

    function updateCountdown(){
      if(!stageEndTimestamp){daysSpan.textContent=hoursSpan.textContent=minutesSpan.textContent=secondsSpan.textContent='--';return;}
      const now=Math.floor(Date.now()/1000), diff=stageEndTimestamp-now;
      if(diff<=0){daysSpan.textContent=hoursSpan.textContent=minutesSpan.textContent=secondsSpan.textContent='00';return;}
      const d=Math.floor(diff/86400), h=Math.floor((diff%86400)/3600), m=Math.floor((diff%3600)/60), s=diff%60;
      daysSpan.textContent=String(d).padStart(2,'0'); hoursSpan.textContent=String(h).padStart(2,'0');
      minutesSpan.textContent=String(m).padStart(2,'0'); secondsSpan.textContent=String(s).padStart(2,'0');
    }

    async function refreshContractData(){
      try{
        const readContract = new ethers.Contract(CONFIG.CONTRACT_ADDRESS, ABI, readProvider);

        const [raisedWei,stage,priceWei,rateRaw,endTime,hardCapWei] = await Promise.all([
          readContract.totalRaised().catch(()=>ethers.constants.Zero),
          readContract.currentStage().catch(()=>1),
          readContract.getCurrentPrice().catch(()=>ethers.constants.Zero),
          readContract.getRate().catch(()=>ethers.constants.Zero),
          readContract.stageEndTime().catch(()=>ethers.constants.Zero),
          readContract.hardCap().catch(()=>ethers.utils.parseEther('2000'))
        ]);

        totalRaisedBNB=parseFloat(ethers.utils.formatEther(raisedWei));
        hardcapBNB=parseFloat(ethers.utils.formatEther(hardCapWei));
        currentRate = rateRaw.gt(0) ? Number(rateRaw.toString()) : 0;
        stageEndTimestamp = Number(endTime.toString());

        totalRaisedSpan.textContent = `${totalRaisedBNB.toFixed(2)} BNB`;
        currentStageSpan.textContent = `Stage ${stage}`;
        currentPriceSpan.textContent = `${parseFloat(ethers.utils.formatEther(priceWei||0)).toFixed(8)} BNB`;
        tokenRateSpan.textContent = `${currentRate||0} $BULL`;

        const p=Math.max(0,Math.min(100,(totalRaisedBNB/hardcapBNB)*100));
        progressPercent.textContent=p.toFixed(2)+'%';
        progressBarFill.style.width=p+'%';

        updateCountdown();
        estimateTokens();

        if(provider && userAddress){
          const bal = await provider.getBalance(userAddress);
          walletBalanceSpan.textContent = parseFloat(ethers.utils.formatEther(bal)).toFixed(4);
        }
      }catch(e){
        console.warn('refreshContractData fail',e);
      }
    }

    // ====== Web3Modal v2ÔºàÁ®≥ÂÆöÔºâ======
    const chains=[bsc];
    const { publicClient } = configureChains(chains, [w3mProvider({ projectId: CONFIG.WALLETCONNECT_PROJECT_ID })]);
    const wagmiClient = createClient({
      autoConnect:true,
      connectors:w3mConnectors({ projectId: CONFIG.WALLETCONNECT_PROJECT_ID, chains }),
      publicClient
    });
    const ethereumClient = new EthereumClient(wagmiClient, chains);
    const web3modal = new Web3Modal({
      projectId: CONFIG.WALLETCONNECT_PROJECT_ID,
      themeMode:'dark'
    }, ethereumClient);

    async function connectWallet(){
      try{
        connectBtn.disabled=true; connectBtn.innerHTML='<span class="loading-spinner"></span>';
        await web3modal.openModal();

        // Á≠âÂæÖÊ≥®ÂÖ• provider
        const injected = await new Promise((resolve,reject)=>{
          let t=0; const id=setInterval(()=>{
            t+=200;
            if(window.ethereum){clearInterval(id);resolve(window.ethereum);}
            if(t>8000){clearInterval(id);reject(new Error('No wallet provider'));}
          },200);
        });

        provider = new ethers.providers.Web3Provider(injected, 'any');
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        contract = new ethers.Contract(CONFIG.CONTRACT_ADDRESS, ABI, signer);

        const net = await provider.getNetwork();
        setNetworkBadge(net.chainId);

        if(net.chainId!==CONFIG.CHAIN_ID){
          try{
            await injected.request({method:'wallet_switchEthereumChain', params:[{chainId:'0x38'}]});
          }catch{
            showNotification('Wrong Network','Please switch to BNB Smart Chain',true);
          }
        }

        connectBtn.textContent=`${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
        disconnectBtn.style.display='inline-block';
        buyButton.disabled=false; buyButton.textContent='Buy $BULL';
        claimButton.style.display='block';
        referralLink2.value=`${location.origin}?ref=${userAddress}`;

        injected.removeAllListeners?.('accountsChanged');
        injected.removeAllListeners?.('chainChanged');
        injected.on?.('accountsChanged', ()=>location.reload());
        injected.on?.('chainChanged', ()=>location.reload());

        await refreshContractData();
        showNotification('Connected','Wallet connected');
      }catch(e){
        connectBtn.disabled=false; connectBtn.textContent='Connect Wallet';
        showNotification('Connection failed', e.message || String(e), true);
      }
    }

    async function disconnectWallet(){
      provider=null; signer=null; contract=null; userAddress=null;
      connectBtn.disabled=false; connectBtn.textContent='Connect Wallet';
      disconnectBtn.style.display='none';
      networkBadge.style.display='none';
      buyButton.disabled=true; buyButton.textContent='Connect Wallet To Buy';
      claimButton.style.display='none';
      walletBalanceSpan.textContent='0.00';
      referralLink2.value='Connect wallet to generate...';
      showNotification('Disconnected','Wallet disconnected');
    }

    async function buyTokens(){
      if(!contract || !provider || !signer){showNotification('Not Connected','Please connect wallet',true);return;}
      try{
        const amount=parseFloat(bnbAmountInput.value);
        if(!amount || amount<=0){showNotification('Invalid amount','Enter valid BNB amount',true);return;}
        const slippage=parseFloat(slippageInput.value||'1')/100;
        const expected=amount*currentRate;
        const minOut=Math.floor(expected*(1-slippage));
        const ref = (referrerInput.value||'').trim();
        const refAddr = ethers.utils.isAddress(ref)?ref:ethers.constants.AddressZero;

        const tx = await contract.buyTokens(refAddr, minOut, {value: ethers.utils.parseEther(String(amount))});
        showNotification('Submitted', `Tx: ${tx.hash.slice(0,10)}...`);
        await tx.wait();
        showNotification('Success','You bought $BULL');
        bnbAmountInput.value='';
        estimateTokens();
        await refreshContractData();
      }catch(e){
        showNotification('Transaction failed', e?.data?.message || e.message || String(e), true);
      }
    }

    async function claimTokens(){
      if(!contract){showNotification('Not Connected','Please connect wallet',true);return;}
      try{
        const tx=await contract.claimTokens();
        showNotification('Submitted', `Tx: ${tx.hash.slice(0,10)}...`);
        await tx.wait();
        showNotification('Success','Claim complete');
      }catch(e){
        showNotification('Claim failed', e?.data?.message || e.message || String(e), true);
      }
    }

    // ‰∫ã‰ª∂
    document.querySelectorAll('[data-nav]').forEach(a=>{
      a.addEventListener('click',(e)=>{
        const target=a.dataset.nav; const href=a.getAttribute('href')||'';
        if(href.startsWith('http')) return;
        e.preventDefault(); history.pushState(null,'',`#${target}`); setActivePage(target);
      });
    });
    window.addEventListener('hashchange',()=>setActivePage(routeFromHash().page));

    jumpToBuyBtn.addEventListener('click', ()=>{
      history.pushState(null,'','#home'); setActivePage('home');
      setTimeout(()=>$('buyFormAnchor')?.scrollIntoView({behavior:'smooth',block:'start'}),80);
    });
    jumpToWhitepaperBtn.addEventListener('click', ()=>{history.pushState(null,'','#whitepaper'); setActivePage('whitepaper');});

    bnbAmountInput.addEventListener('input', estimateTokens);
    connectBtn.addEventListener('click', connectWallet);
    disconnectBtn.addEventListener('click', disconnectWallet);
    buyButton.addEventListener('click', buyTokens);
    claimButton.addEventListener('click', claimTokens);
    copyBtn2.addEventListener('click', async ()=>{
      try{await navigator.clipboard.writeText(referralLink2.value); showNotification('Copied','Referral link copied');}
      catch{referralLink2.select(); document.execCommand('copy'); showNotification('Copied','Referral link copied');}
    });

    document.querySelectorAll('.faq-question').forEach(q=>{
      q.addEventListener('click',()=>{
        const a=q.parentElement.querySelector('.faq-answer');
        const open=a.style.display==='block';
        document.querySelectorAll('.faq-answer').forEach(x=>x.style.display='none');
        a.style.display=open?'none':'block';
      });
    });

    // ÂàùÂßãÂåñ
    const r=routeFromHash(); setActivePage(r.page||'home');
    refreshContractData();
    countdownTimer=setInterval(updateCountdown,1000);
    setInterval(refreshContractData,10000);
  </script>
</body>
</html>
